"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.serverActivity=exports.buildActivity=exports.initActivity=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_constant=require("./constant"),utils=_interopRequireWildcard(require("./utils.js")),wpConfigs=_interopRequireWildcard(require("./wpc")),_server=_interopRequireDefault(require("./server")),_WPConfigs=_interopRequireDefault(require("./WPConfigs.js"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}var console=utils.logger,PRO_DIRECTORY_LIST=["library","documents","static","src","src/apps","src/configs","src/server","src/utils","test"],initActivity=function initActivity(a,b){var c=b.parent._version,d=b.force,e=void 0!==d&&d,f=b.recursive,g=void 0===f||f,h=utils.getResourceAbsolutePath(),i=_path["default"].resolve(".",a);/** 复制必要文件到项目目录下 */if(console.info("Oulate version: ",utils.PKG_VERSION),_fs["default"].mkdirSync(i,{recursive:!0===g}),console.info("\u5DE5\u7A0B\uFF1A",i),PRO_DIRECTORY_LIST.forEach(function(b){utils.mkdirSync(_path["default"].resolve(".",a,b),{force:!0===e,recursive:!0===g}),console.success("\u521B\u5EFA\uFF1A",_path["default"].join(a,b))}),!1===utils.exists(h))throw Error("Missing: Can't not found ".concat(h));_fs["default"].readdirSync(h).forEach(function(b){var c=_path["default"].join(h,b),d=_path["default"].join(i,b);try{_fs["default"].copyFileSync(c,d,+!e),console.success("\u521B\u5EFA\uFF1A",_path["default"].join(a,b))}catch(c){console.error("\u5931\u8D25\uFF1A",_path["default"].join(a,b),"EEXIST"===(c.code+"").toUpperCase()?"\t#redBright([\u5DF2\u5B58\u5728])":"")}}),_fs["default"].writeFileSync(_path["default"].join(i,"package.json"),JSON.stringify({name:_path["default"].basename(a),version:"1.0.0",author:"ChenZhenyuan <jason@chenzhenyuan.com>",license:"MIT",main:"./release/main.js",dependencies:{"@xrosy/generator":"^".concat(utils.PKG_VERSION)},devDependencies:{eslint:"^5.16.0","eslint-config-xrosy":"^0.1.52"}},null,2))};exports.initActivity=initActivity;/* 导出 build 接口 */var buildActivity=function buildActivity(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:".",b=1<arguments.length?arguments[1]:void 0,c=b.env,d=void 0===c?_constant.DEFAULT_ENV:c,e=b.port,f=void 0===e?_constant.SERVER_PORT:e,g=b.service,h=b._name,i=b._description,j=b.parent._version,k=(0,_objectWithoutProperties2["default"])(b,["env","port","service","_name","_description","parent"]);switch(console.log(k),h.toLowerCase()){case"dev":case"build":return(console.log("sss"),console.clear(),console.debug("mode     :","".concat(i?"".concat(i," - ").concat(h):h)),console.debug("version  :","v".concat(j)),console.debug("env      :","".concat(d)),console.debug("workspace:","".concat(process.cwd())),console.debug("port     :","".concat(f)),console.log(_objectSpread({},wpConfigs)),"build"===h.toLowerCase())?void 0:void(0,_server["default"])({env:d,port:f,mode:h});case"server":return void(0,_server["default"])(_objectSpread({env:d,port:f},k));}// builtIn({ workspace, env, mode, description, version, serverport, service });
};exports.buildActivity=buildActivity;var serverActivity=function serverActivity(a){var b=(0,_extends2["default"])({},a);(0,_server["default"])(b)};exports.serverActivity=serverActivity;