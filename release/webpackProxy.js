"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.devActivity=exports.buildActivity=void 0;var _path=_interopRequireDefault(require("path")),_webpack=_interopRequireDefault(require("webpack")),_cleanWebpackPlugin=_interopRequireDefault(require("clean-webpack-plugin")),_htmlWebpackPlugin=_interopRequireDefault(require("html-webpack-plugin")),utils=_interopRequireWildcard(require("./utils.js")),_server=_interopRequireDefault(require("./server.js")),_defConf=require("./defConf.js");function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}return b["default"]=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var wpAgent=function(a){var b=a.workspace,c=void 0===b?".":b,d=a.port,e=a.env,f=a.distDir,g=utils.getWorkspace(c),h=utils.xrosyrc(g),i=_path["default"].join(g,"./build"),j={context:g,mode:"none",devtool:"eval-source-map",entry:{admin:["webpack-hot-middleware/client","./src/admin/index.js"]},output:{path:i,filename:"[name].js",publicPath:"/",pathinfo:!1},resolve:{/* 引入依赖或者文件时，强制要求添加文件的扩展名 */alias:{},extensions:[".js",".jsx"],enforceExtension:!1,/* 对模块是否需要使用的扩展 */enforceModuleExtension:!1// modules: [ path.join(wpWorkspace, 'node_modules') ],
},module:{rules:[{test:/\.(js|jsx)$/,exclude:/(node_modules|bower_components)/,use:{loader:"babel-loader",options:{presets:["@babel/preset-env","@babel/preset-react"]}}}]},plugins:[new _cleanWebpackPlugin["default"]({dry:!1,verbose:!1}),new _webpack["default"].DefinePlugin({env:JSON.stringify(process.env.NODE_ENV||"dev")}),// new webpack.ProgressPlugin(),
new _webpack["default"].HotModuleReplacementPlugin,new _webpack["default"].NoEmitOnErrorsPlugin,new _htmlWebpackPlugin["default"]({chunks:["library","utils","admin"]})],optimization:{minimize:!0,splitChunks:{cacheGroups:{libs:{name:"library",test:/node_modules/,chunks:"initial",// 打包后的文件名，任意命名
// 设置优先级，防止和自定义的公共代码提取时被覆盖，不进行打包
priority:10},utils:{name:"utils",chunks:"initial",// 只要超出0字节就生成一个新包
minSize:0}}}}};return(0,_webpack["default"])(j)},buildActivity=function(a,b){var c=b.env,d=b.port,e=void 0===d?_defConf.CONST_PORT:d;wpAgent({workspace:a})};/* -------------------------------------------------------------------------- */ /*  */exports.buildActivity=buildActivity;/*  */var devActivity=function(a,b){var c=b.env,d=b.port,e=void 0===d?_defConf.CONST_PORT:d;(0,_server["default"])(wpAgent({workspace:a}))};exports.devActivity=devActivity;